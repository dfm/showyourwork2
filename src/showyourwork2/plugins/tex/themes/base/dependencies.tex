((* block packages *))
\RequirePackage[notref, notcite]{showkeys} % showkeyslabelformat
\RequirePackage{graphicx} % includegraphics
\RequirePackage{etoolbox} % ifcsmacro
((* endblock *))

((* block commands *))
% Disable the bibliography
\renewcommand{\bibliography}[1]{}

% Disable user-facing commands
\newcommand\showyourwork{}
((* endblock *))

((* block log *))
((* block setup *))
\newwrite\syw@LogFile
\immediate\openout\syw@LogFile=\jobname.dependencies.xml
\newcommand\syw@LogMessage[1]{%
    \protected@write
    \syw@LogFile
    {\let\tmp\write\def\write{\immediate\tmp}}%
    {#1}%
}

% Log something to ensure the XML file gets created
\syw@LogMessage{<!--XML article tree automatically generated by showyourwork-->}
((* endblock *))

((* block labels *))
\renewcommand\showkeyslabelformat[1]{%
\syw@LogMessage{<LABEL>#1</LABEL>}%
}
((* endblock *))

((* block figures *))
\ifcsmacro{figure}{
\let\oldfigure\figure
\let\oldendfigure\endfigure
\renewenvironment{figure}{%
    \syw@LogMessage{<FIGURE>}%
    \oldfigure%
}{%
    \oldendfigure%
    \syw@LogMessage{</FIGURE>}%
}
\renewenvironment{figure*}{%
    \syw@LogMessage{<FIGURE>}%
    \oldfigure%
}{%
    \oldendfigure%
    \syw@LogMessage{</FIGURE>}%
}
}{}
((* endblock *))

((* block equations *))
\ifcsmacro{align}{
\let\oldalign\align
\let\oldendalign\endalign
\renewenvironment{align}{%
    \syw@LogMessage{<ALIGN>}%
    \oldalign%
}{%
    \oldendalign%
    \syw@LogMessage{</ALIGN>}%
}
\renewenvironment{align*}{%
    \syw@LogMessage{<ALIGN>}%
    \oldalign%
}{%
    \oldendalign%
    \syw@LogMessage{</ALIGN>}%
}
}{}
((* endblock *))

((* block captions *))
\ifcsmacro{caption}{
\renewcommand{\caption}{%
    \syw@LogMessage{<CAPTION />}%
}
}
((* endblock *))

((* block graphics *))
\renewcommand{\includegraphics}[2][]{%
\syw@LogMessage{<GRAPHICS>#2</GRAPHICS>}%
}
((* endblock *))

((* block graphicspath *))
\renewcommand{\graphicspath}[1]{%
\syw@LogMessage{<GRAPHICSPATH>#1</GRAPHICSPATH>}%
}
((* endblock *))

((* block variables *))
% Alias of \input for syw-controlled files; but make it a no-op at the
% pre-processing stage that simply prints the argument to the log so we can add
% the file to the workflow graph
\newcommand\variable[1]{%
\syw@LogMessage{<INPUT>#1</INPUT>}%
}
((* endblock *))

((* block custom *))
% Log custom figure links
% \newcommand\marginicon[1]{%
%     \syw@LogMessage{<MARGINICON />}%
% }

% Log figure script commands
% \newcommand\script[1]{%
%     \syw@LogMessage{<SCRIPT>#1</SCRIPT>}%
% }
((* endblock *))

((* endblock *)) ((= log =))
